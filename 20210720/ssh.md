<h1 style="text-align:center">ssh</h1>

ssh(secure )
ssh是一种网络协议，用于计算机之间的**加密登录**。

## ssh原理

![CS架构](E:\Box\img\ssh登录原理示意图.png)

## ssh基本用法

1. 主机启用ssh

```
$ netstat -tnlp | grep ssh
tcp         0       0.0.0.0:22      0.0.0.0:*       LISTEN      2047/sshd
...

```

2. 语法

```
$ ssh -p 22 user@hoot
$ ssh user@hoot
$ ssh host
```

## ssh端口转发

ssh不仅能够自动加密和解密ssh客户端和服务端之间的网络数据，同时，ssh还提供了一个十分有用的功能 -- 端口转发。端口转发可以将TCP端口的网络数据，转发到指定的主机的某个端口，在转发的同时会对数据进行相应的加密及解密。如果工作环境中的防火墙限制了一些网络端口的使用，但是允许ssh的连接，那么也是能够通过使用ssh转发后的端口进行通信。主要分为本地转发和远程转发两种类型：

1. 转发的参数

```ssh
-C 压缩数据
-f 后台认证用户/密码,通常和-N连用，不用登录到远程主机。
-N ：不执行脚本或命令，通常与-f连用。
-g ：在-L/-R/-D参数中，允许远程主机连接到建立的转发的端口，如果不加这个参数，只允许本地主机建立连接。
-L : 本地端口:目标IP:目标端口
-D : 动态端口转发
-R : 远程端口转发
-T ：不分配 TTY 只做代理用
-q ：安静模式，不输出 错误/警告 信息
```

### 本地转发

将发送到本地端口的请求，转发到目标端口。格式如下：

`ssh -L 本地网卡地址:本地端口:目标地址:目标端口 用户@目标地址`

示例：

1. centOS A(192.168.13.139)centOS B(192.168.13.142)
2. B上安装了MySQL，设置仅允许本地登录
3. A该如何连接到B上的MySQL呢？

实现步骤

1. 端口映射(port mapping)

`ssh -L 127.0.0.1:3306:127.0.0.1:3306 root@192.168.13.142`

2. 从A连接到B上MySQL

`mysql -h 127.0.0.1 -u username -p`

在centOS A上查看ssh转发监听的进程

```
$ lsof -i:3306
$ netstat -antp | grep 3306
$ ps -ef | grep ssh
```

### 远程转发

将发送给远程端口的请求，转发给目标端口。语法格式如下：

`ssh -R 远程网卡地址:远程端口：目标地址：目标端口`

示例：

有三台主机centOS A(192.168.13.139) centOS B(192.168.13.142) win7 C(10.18.78.135).B与C不能直接连接，但A和C都可以连接到B，A和B可以互相连接。
如何实现C与B通信呢？

1. 端口映射(port mapping)

`ssh -R 127.0.0.1:80:10.18.78.135:80 root@192.168.13.142`

2. 注释

B监听自己的80端口，

## ssh存在的问题

ssh协议没有证书中心(CA).如果第三方截获了登录请求，然后冒充远程主机，将伪造的公钥发送给用户，用户很难辨别真伪。